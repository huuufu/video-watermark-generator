# ビデオウォーターマーク自動追加スクリプト

## プロジェクト概要

このスクリプトは、動画ファイル（特に `.mp4` フォーマット）に対して自動的にウォーターマークを追加するためのツールです。ウォーターマークは字幕ファイル（`.ass`）を解析し、指定されたテキストを動画の特定の位置に動的に配置します。ウォーターマークの位置はランダムに選択され、一定の間隔で自動的に移動するため、視聴者にとって自然な見た目を保ちながら動画の著作権保護に役立ちます。

## 主な機能

- **ウォーターマークの自動配置**: 指定したテキストを動画の複数の位置に自動的に配置し、ランダムに移動します。
- **解像度の自動取得**: 動画および字幕ファイルから解像度を自動的に取得し、適切なウォーターマークサイズと位置を決定します。
- **字幕ファイルの解析と編集**: `.ass` 字幕ファイルを読み込み、新しいウォーターマークのダイアログを追加します。
- **動的なウォーターマークの移動**: 一定の時間間隔でウォーターマークの位置を変更し、動画全体にわたって動的に表示します。
- **エラーハンドリング**: Unicodeデコードエラーなどの一般的なエラーをキャッチし、適切に処理します。

## 必要な環境

このスクリプトを実行するためには、以下の環境が必要です：

- **Python**: バージョン 3.6 以上
- **ライブラリ**:
  - `moviepy`
  - `re`
  - `os`
  - `random`
  - `contextlib`

## 使い方

1. **ウォーターマークテキストの設定**:
   スクリプト内の `target_texts` リストに、ウォーターマークとして表示したいテキストを追加します。複数のテキストを設定することで、ランダムに選ばれて表示されます。

   ```python
   target_texts = [
       "Your Watermark Text Here",  # ウォーターマーク設定（複数可、自動ローテーション）
       #"Second Watermark",
       #"Third Watermark",
   ]
   ```

2. **スクリプトの実行**:
   コマンドラインまたはターミナルでスクリプトが保存されているディレクトリに移動し、以下のコマンドを実行します。

   ```bash
   python video-watermark-generator.py
   ```

   スクリプトが現在の作業ディレクトリ内のすべての `.ass` 字幕ファイルと対応する `.mp4` 動画ファイルを検索し、ウォーターマークを追加します。

3. **結果の確認**:
   スクリプトの実行後、各 `.ass` 字幕ファイルが更新され、ウォーターマークが追加されています。動画を再生して、ウォーターマークが正しく表示されていることを確認してください。

## 設定

- **ウォーターマークの移動間隔**:
  ウォーターマークが移動する間隔を変更するには、`interval` 変数の値を調整します。デフォルトでは 20 秒ごとに移動します。

  ```python
  interval = 20  # ウォーターマークの移動間隔（秒）
  ```

- **ウォーターマークのフォントとスタイル**:
  スタイルの設定は `.ass` ファイル内で行われます。必要に応じて、フォントや色、サイズを変更してください。スクリプト内でスタイル `SY` を追加していますが、必要に応じて編集可能です。

  ```python
  file.write("Style: SY,Noto Sans SC Black,55,&H99FFFFFF,&H99FFFFFF,&H00000000,&H1E6A5149,1,0,0,0,100.00,100.00,0.00,0.00,1,2.5,0.0,8,0,0,0,1\n")
  ```

- **ウォーターマークの位置調整**:
  ウォーターマークの位置は `points_top`, `points_bottom`, `points_left`, `points_right` の各リストで定義されています。必要に応じて、これらのポイントを調整して希望する位置にウォーターマークを配置できます。

## 使用上の注意

1. **バックアップの作成**:
   スクリプトを実行する前に、元の `.ass` 字幕ファイルと `.mp4` 動画ファイルのバックアップを作成してください。スクリプトの実行により、字幕ファイルが上書きされるため、元に戻すことが困難です。

2. **字幕ファイルの互換性**:
   このスクリプトは `.ass` 字幕ファイルに基づいて動作します。他の字幕フォーマット（例：`.srt`）には対応していません。必要に応じて、適切な字幕形式に変換してください。

3. **動画の解像度**:
   スクリプトは動画の解像度を自動的に取得し、ウォーターマークのサイズと位置を調整します。しかし、特殊な解像度やアスペクト比の動画では、ウォーターマークの表示が意図した通りにならない場合があります。その際は、スクリプト内の設定を手動で調整してください。

4. **依存関係の管理**:
   スクリプトが依存するライブラリ（特に `moviepy`）は、最新のバージョンを使用することを推奨します。古いバージョンでは互換性の問題が発生する可能性があります。

5. **パフォーマンス**:
   大規模な動画ファイルや大量の字幕ファイルを処理する場合、スクリプトの実行に時間がかかることがあります。処理中はコンピュータのパフォーマンスに注意し、必要に応じてスクリプトの最適化を検討してください。

6. **著作権と法的責任**:
   ウォーターマークの追加は著作権保護の一環として有用ですが、使用する際は関連する法律や規約を遵守してください。不適切な使用は法的責任を招く可能性があります。

## トラブルシューティング

- **UnicodeDecodeError**:
  字幕ファイルのエンコーディングに問題がある場合、スクリプトは `UnicodeDecodeError` を表示します。この場合、字幕ファイルのエンコーディングを確認し、必要に応じて変更してください。

- **ウォーターマークが表示されない**:
  - 字幕ファイルが正しく読み込まれていない可能性があります。スクリプトの実行ログを確認し、エラーがないかチェックしてください。
  - ウォーターマークの位置が動画の外に設定されている場合、表示されません。ウォーターマークの位置設定を確認してください。

- **スタイルが適用されない**:
  `.ass` ファイル内で新しいスタイル `SY` が正しく追加されていない場合、ウォーターマークが意図したスタイルで表示されません。スタイル設定部分を再確認してください。

## ライセンス

このプロジェクトは [MITライセンス](LICENSE) の下で公開されています。詳細については、`LICENSE` ファイルを参照してください。

## 作者

- **名前**: 現在のところありません
- **連絡先**: https://space.bilibili.com/9047380

## 最後に

このスクリプトが動画の著作権保護やブランド認知向上に役立つことを願っています。ご質問やフィードバックがありましたら、上記の連絡先までお気軽にお問い合わせください。
